# Flash Plugin v1.4.2 - Domain Compatibility Release Summary

## Release Information
- **Version**: 1.4.2
- **Release Date**: June 13, 2025
- **Type**: Critical Patch Release
- **Package**: `BTCPayServer.Plugins.Flash-v1.4.2.btcpay`

## What Was Fixed

### 1. WebSocket Endpoint Resolution
**Problem**: WebSocket endpoints were hardcoded to `ws.test.flashapp.me` or `ws.flashapp.me`
**Solution**: Implemented dynamic derivation from API endpoint:
- `api.domain.com` → `ws.domain.com`
- Supports localhost, IP addresses, and custom domains
- Automatic protocol selection (wss/ws)

### 2. External Link Generation
**Problem**: External links always pointed to `https://flashapp.me`
**Solution**: Links now derive from the connection string configuration

### 3. Domain-Agnostic Architecture
**Problem**: Plugin only worked reliably on test environment
**Solution**: Complete domain independence - works on any BTCPay Server instance

## Code Changes

### Modified Files
1. **FlashLightningClient.cs**
   - Lines 223-249: Replaced hardcoded WebSocket logic with dynamic derivation
   - Added intelligent host transformation logic
   - Protocol selection based on API scheme

2. **FlashLightningConnectionStringHandler.cs**
   - Lines 163-186: Updated GetExternalLink method
   - Derives external URL from connection string
   - Removes "api." prefix when present

### Version Updates
- BTCPayServer.Plugins.Flash.csproj: 1.4.1 → 1.4.2
- FlashPlugin.cs: Version property updated
- manifest.json: Version updated
- btcpayserver.json: Version updated
- CHANGELOG.md: Added v1.4.2 entry
- README.md: Updated version history

## Testing Verification

The plugin now correctly handles:
- ✅ Standard Flash deployments (api.flashapp.me)
- ✅ Custom domain deployments
- ✅ Localhost development environments
- ✅ IP address-based deployments
- ✅ BTCPay Server behind reverse proxies
- ✅ Non-standard ports
- ✅ HTTP and HTTPS schemes

## Impact

This release ensures the Flash plugin works correctly on:
- Any BTCPay Server domain
- Self-hosted Flash instances
- Development environments
- Production deployments with custom domains

## Upgrade Instructions

1. Download `BTCPayServer.Plugins.Flash-v1.4.2.btcpay`
2. Upload via BTCPay Server plugin manager
3. Restart BTCPay Server
4. Verify WebSocket connections in logs

## Verification Steps

After installation, check logs for:
```
Connecting to Flash WebSocket at wss://[your-configured-domain]/graphql
```

The domain should match your Flash API configuration, not a hardcoded value.

## Future Considerations

- Continue monitoring for any hardcoded references
- Consider adding configuration validation UI
- Implement health check for WebSocket connectivity
- Add domain configuration documentation

## Files Delivered

1. `BTCPayServer.Plugins.Flash-v1.4.2.btcpay` - Plugin package
2. `DOMAIN_COMPATIBILITY_ISSUES.md` - Issue documentation
3. `DOMAIN_COMPATIBILITY_FIXES.md` - Fix documentation
4. `DOMAIN_COMPATIBILITY_SUMMARY.md` - User-facing summary
5. `RELEASE_NOTES_v1.4.2.md` - Release notes
6. Updated documentation and version files

## Conclusion

Version 1.4.2 successfully addresses all domain compatibility issues, making the Flash plugin truly universal and ready for deployment on any BTCPay Server instance.