# BTCPayServer.Plugins.Flash v1.3.3 Installation Guide

## What's New

This update (v1.3.3) includes important fixes for Boltcard compatibility:

- Added GraphQL schema feature detection for better compatibility with different API versions
- Fixed issues with decodeInvoice API by implementing a fallback parser
- Fixed exchange rate lookups with fallbacks to CoinGecko and CoinDesk when btcToCurrency is unavailable
- Enhanced payment hash tracking with deterministic ID generation
- Improved transaction ID to payment hash mapping
- Optimized wallet initialization and authentication flow
- Prevented redundant plugin initialization
- Fixed "No transaction found for payment hash" errors with better tracking
- Enhanced overall Boltcard payment reliability

## Installation Instructions

### Method 1: Via BTCPay Server Admin UI (Recommended)

1. Download the `.btcpay` package from:
   - `/Users/dread/Documents/Island-Bitcoin/Flash/claude/BTCPayServer.Plugins.Flash/releases/BTCPayServer.Plugins.Flash-v1.3.3.btcpay`

2. In your BTCPay Server, go to:
   - **Server Settings > Plugins**

3. Click **Choose File** and select the downloaded `.btcpay` package

4. Click **Upload** to install the plugin

5. You will be prompted to restart your BTCPay Server. Click **Restart** to complete the installation.

6. After restart, verify the plugin is installed with version 1.3.3 in the plugins list.

### Method 2: Manual Installation

If the UI installation doesn't work, you can install the plugin manually:

1. Stop your BTCPay Server instance

2. Copy the `.btcpay` package to your BTCPay Server plugins directory:
   ```
   /root/.btcpayserver/plugins/
   ```

3. Unzip the contents into a folder named `BTCPayServer.Plugins.Flash`

4. Restart your BTCPay Server

## Testing Boltcard Topups

1. After installing the updated plugin, go to the Boltcards section of BTCPay Server

2. Select a card to top up, or create a new card

3. Enter the amount you want to add to the card

4. Proceed with the payment

5. Monitor the logs for these improvements:
   - Automatic feature detection for decodeInvoice and btcToCurrency
   - Fallback to alternative decoders when API features aren't available
   - Improved payment hash tracking and consistent transaction IDs

## Troubleshooting

If you encounter any issues:

1. Check BTCPay Server logs for error messages

2. Verify the plugin version shows as 1.3.3 in Server Settings > Plugins

3. If you're experiencing authorization errors:
   - Verify your Flash API token is correct
   - Update your connection string in Store Settings > Lightning > Payment Methods

4. If exchange rate lookups are failing:
   - The plugin now includes multiple fallbacks and should work regardless

5. For persistent issues, you can completely uninstall and reinstall the plugin through the UI

## Support

If you need assistance with this plugin:
- Open an issue on the GitHub repository
- Join the BTCPay Server community on Mattermost
- Contact Flash support for account-specific issues