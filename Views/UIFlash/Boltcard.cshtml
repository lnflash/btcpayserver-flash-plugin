@{
    ViewData["Title"] = "Boltcard Topup";
    Layout = "_Layout";
}

<div class="container">
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex align-items-center">
                <img src="~/img/icons/flash.svg" width="50" height="50" class="me-3" alt="Flash Logo" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' width=\'50\' height=\'50\'><path d=\'M11 21h-1l1-7H7.5c-.58 0-.912-.753-.588-1.266L12.562 3h1l-1 7h3.5c.555 0 .869.73.55 1.221L11 21Z\' fill=\'%23FFD700\'/></svg>'" />
                <div>
                    <h1 class="mb-0">Boltcard Topup</h1>
                    <p class="text-muted mb-0">Flash Plugin v@(ViewData["PluginVersion"])</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="h4 mb-0"><i class="fas fa-credit-card me-2"></i>Topup Form</h2>
                </div>
                <div class="card-body">
                    <form id="topupForm" action="#" onsubmit="submitForm(event)">
                        <div class="form-group mb-4">
                            <label for="amount" class="form-label fw-bold">Amount (satoshis)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="amount" name="amount" min="500" max="100000" value="5000">
                                <span class="input-group-text">sats</span>
                            </div>
                            <small class="form-text text-muted">Enter amount between 500 and 100,000 satoshis</small>
                        </div>
                        
                        <div class="form-group mb-4">
                            <label for="description" class="form-label fw-bold">Description</label>
                            <input type="text" class="form-control" id="description" name="description" value="Flashcard topup">
                            <small class="form-text text-muted">This will appear in your transaction history</small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-bolt me-2"></i>Create Lightning Invoice
                            </button>
                            <a href="/plugins/flash" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Flash Dashboard
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="h5 mb-0"><i class="fas fa-info-circle me-2"></i>About Boltcards</h3>
                </div>
                <div class="card-body">
                    <p>
                        Boltcards are NFC-enabled cards that allow you to make Lightning payments by simply tapping
                        your card on an NFC reader. They work seamlessly with the Flash Lightning wallet.
                    </p>
                    <p class="mb-0">
                        <a href="https://www.boltcard.org/" target="_blank" class="text-decoration-none">
                            <i class="fas fa-external-link-alt me-2"></i>Learn more about Boltcards
                        </a>
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h3 class="h5 mb-0"><i class="fas fa-question-circle me-2"></i>How It Works</h3>
                </div>
                <div class="card-body">
                    <ol class="mb-0">
                        <li class="mb-3">Enter the amount you want to add to your Boltcard</li>
                        <li class="mb-3">Click "Create Lightning Invoice" to generate an invoice</li>
                        <li class="mb-3">Scan the QR code with your Flash mobile wallet</li>
                        <li class="mb-3">Complete the payment within your Flash app</li>
                        <li>Once payment is confirmed, your Boltcard will be topped up</li>
                    </ol>
                </div>
            </div>
            
            <div class="card bg-light">
                <div class="card-body">
                    <h4 class="h5 mb-3"><i class="fas fa-lightbulb me-2"></i>Tips</h4>
                    <ul class="mb-0">
                        <li class="mb-2">Recommended topup amount: 5,000 - 50,000 sats</li>
                        <li class="mb-2">Invoices expire after 60 minutes</li>
                        <li>Payment confirmation is usually instant</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Form handling
        function submitForm(e) {
            e.preventDefault();
            
            const amountInput = document.getElementById('amount');
            const descriptionInput = document.getElementById('description');
            
            const amount = parseInt(amountInput.value);
            if (isNaN(amount) || amount < 500 || amount > 100000) {
                alert('Please enter a valid amount between 500 and 100,000 satoshis.');
                amountInput.focus();
                return;
            }
            
            // Get the current URL path and append the process endpoint
            const basePath = window.location.pathname;
            const baseUrl = basePath.endsWith('/') ? basePath : basePath + '/';
            
            // Create the URL with parameters
            const url = `${baseUrl}process?amount=${amount}&description=${encodeURIComponent(descriptionInput.value)}`;
            
            // Navigate to the URL
            window.location.href = url;
        }
    </script>
}